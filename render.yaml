services:
  # 1. 后端 API 服务 (FastAPI)
  - type: web
    name: casecheck-api
    env: python
    region: singapore
    plan: free
    branch: main
    buildCommand: pip install -r requirements.txt
    # 直接启动，移除磁盘挂载和初始化脚本 (Free Tier 不支持磁盘)
    startCommand: uvicorn src.api.main:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: PYTHON_VERSION
        value: 3.10.0
      # 移除路径覆盖，默认使用代码库中的 data 目录 (非持久化)

  # 2. 前端 Web 服务 (Streamlit)
  - type: web
    name: casecheck-web
    env: python
    region: singapore
    plan: free
    branch: main
    buildCommand: pip install -r requirements.txt
    # 动态拼接 API URL
    startCommand: export API_URL="http://$API_HOST_PORT" && streamlit run src/web/app.py --server.port $PORT --server.address 0.0.0.0
    envVars:
      - key: PYTHON_VERSION
        value: 3.10.0
      # 获取后端的 host:port
      - key: API_HOST_PORT
        fromService:
          type: web
          name: casecheck-api
          property: hostport